/*!
 * Project: Summary Box for Wikipedia links (formerly Wikipedia preview boxes)
 * Version: 1.1.1 (Released: 04.11.2023) | Initial Release: 1.0.0 (12.10.2021)
 * License: GPL v3 (Current) | MIT (Initial)
 * Availability: Standalone; also available as a WordPress plugin, see project page
 * Project Page: https://su-pa.net/wikiPrevBox/
 * Author: Dominik Fehr, wikinick@su-pa.net, su-pa.net
 * Description: Turns Wikipedia links into links that show nice summary preview boxes.
 */
!function(){"use strict";document.getElementsByTagName("head")[0].insertAdjacentHTML("beforeend",'<link rel="stylesheet" type="text/css" href="/wikiPrevBox/wikiPreviewBox.min.css">');document.body.insertAdjacentHTML("afterbegin",'<article id="wikiPreviewBox" class="wikiPreviewBox"></article>');let e=!1,t="target='_blank'",i=300,n=280,s=.9,r=!0,o="</a> (wikipedia.org)",l=document.dir||"";if(void 0!==document.currentScript.dataset.wikipreview){const o=document.currentScript.dataset.wikipreview.split(",").reduce(((e,t)=>{const[i,n]=t.split("=");return e[i]=void 0===n||(isNaN(n)?n:parseFloat(n)),e}),{}),{noimages:l,openlinkinsamewindow:a,width:c,numberofchars:d,fontsize:p,nowikilinknote:u}=o;e=l||e,t=a?"":t,i=Math.min(Math.max(parseInt(c||300),200),400),n=Math.min(Math.max(parseInt(d||280),100),600),s=Math.min(Math.max(parseFloat(p||.9),.3),2),r=u?r=!1:r}let a,c,d="",p="",u="",g=document.getElementById("wikiPreviewBox");g.style.width=i+"px",g.style.fontSize=s+"em",g.style.zIndex=[...document.querySelectorAll`*`].reduce(((e,t,i,n,s=+window.getComputedStyle(t).zIndex||0)=>s>e?s:e),0)+1,g.addEventListener("click",v),g.addEventListener("mouseover",k),g.addEventListener("mouseout",v);let h=document.querySelectorAll("[href*='wikipedia.org']:not([href*='#nopreview'])"),w=document.querySelectorAll("[href*='#nopreview']");for(let e=0;e<w.length;e++)w[e].href=w[e].href.replace("#nopreview","");for(let e=0;e<h.length;e++)h[e].classList.add("wikiLink"),"rtl"===l&&h[e].classList.add("wikiLink_rtl"),h[e].addEventListener("mouseover",(e=>{c=e.currentTarget,p=c.href,d=""+p.split("/").pop(),u=p.split(".")[0].split("//")[1],a=c.getBoundingClientRect();let t=a.left-i/2+(a.right-a.left)/2;t<0&&(t=10);let n=window.innerWidth;n<i?t=n-i+(i-n):t+i>n&&(t=n-i-20),g.style.left=t+"px",f(d,u)}),!1),h[e].addEventListener("click",(e=>{e.preventDefault()})),h[e].addEventListener("mouseout",v);function m(e){const t=["b","i","p","strong","ul","li","img","span","a","sup","sub","div","ol"];return e.replace(/<\/?([a-zA-Z0-9]+)(\s+[^>]*)?>/g,((e,i)=>(i=i.toLowerCase(),t.includes(i)?e:e.replace(/</g,"&lt;").replace(/>/g,"&gt;"))))}function f(i,s="en"){const l=(i=(i.charAt(0).toUpperCase()+i.slice(1)).replace(/ /g,"_")).includes("#showimage");l&&(i=i.replace("#showimage",""));const a=i.includes("#dontshowimage");a&&(i=i.replace("#dontshowimage",""));let c=[];navigator.onLine&&fetch(`https://${s}.m.wikipedia.org/api/rest_v1/page/summary/${i}`).then((d=>{d.ok&&d.json().then((d=>{const p=m(d.title),h=m(d.extract_html),w=d?.thumbnail?.source??"";c=""!==w&&!e&&!a||l?[`<img height="${m((d?.thumbnail?.height??0).toString())}" src="${m(w)}"/>`,h,`https://${s}.wikipedia.org/wiki/${i}`,p]:["",h,`https://${s}.wikipedia.org/wiki/${i}`,p],function(e,i){let s="";if(s=e[0],e[1].length<=n)s+=e[1],"."==s.slice(-1)&&(s=s.substring(0,s.length-1));else{let t=e[1].substr(e[1].lastIndexOf("<"),e[1].length);s+="</p>"===t?e[1].substring(0,n-3):e[1].substring(0,n-9),"."==s.slice(-1)&&(s=s.substring(0,s.length-1)),s+="&nbsp;..."+t}g.innerHTML=s,r||(o="ltr"===i?"<span class='wikiArrow_ltr'>&#x279C;</span></a>":"<span class='wikiArrow_rtl'>&#x279C;</span></a>");let l="<span class='wikiBoxfooter_"+i+"'><a href='"+e[2]+"' "+t+" rel='noopener'>"+e[3]+o+"</span><a href='https://su-pa.net/wikiPrevBox/' target='_blank' rel='noopener' title='Summary box for Wikipedia links - click for info' alt='Summary box for Wikipedia links - click for info'><span class='wikiBoxLogo-w_"+i+"'>W</span></a>";l=m(l),g.insertAdjacentHTML("beforeend",l),g.getElementsByTagName("P")[0].setAttribute("lang",u),g.getElementsByTagName("P")[0].setAttribute("dir",i),k()}(c,d.dir)}))}))}function k(){let e=g.getBoundingClientRect().height||400,t=a.bottom,i=window.innerHeight;t<e?(g.style.top=t+window.scrollY+"px",t+e>i&&(g.style.top=window.scrollY+"px")):g.style.top=a.top+window.scrollY-g.getBoundingClientRect().height+"px",g.style.opacity=1,g.style.visibility="visible"}function v(){c.matches(":hover")||(g.style.opacity=0,g.style.visibility="hidden")}}();